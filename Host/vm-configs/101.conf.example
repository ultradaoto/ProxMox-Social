# Proxmox VM Configuration - Ubuntu AI Controller (ID 101)
# Copy to /etc/pve/qemu-server/101.conf and adjust as needed

# Basic VM settings
name: Ubuntu-AI-Controller
vmgenid: auto
ostype: l26  # Linux 2.6+ kernel
scsihw: virtio-scsi-single
machine: q35
bios: ovmf  # UEFI boot

# CPU and Memory - AI workloads need more resources
cores: 8
sockets: 1
cpu: host
memory: 16384  # 16GB for AI models
balloon: 0  # Disable ballooning for consistent performance

# Storage (adjust path as needed)
scsi0: local-lvm:vm-101-disk-0,size=100G,ssd=1,discard=on
efidisk0: local-lvm:vm-101-disk-1,efitype=4m,size=1M

# CD-ROM for Ubuntu installation (remove after install)
# ide2: local:iso/ubuntu-22.04.3-live-server-amd64.iso,media=cdrom

# Display - minimal for server
vga: std,memory=16

# Network adapters
# net0: External network for internet access (package downloads, Ollama)
net0: virtio,bridge=vmbr0,firewall=1
# net1: Internal bridge for communicating with host and Windows VM
net1: virtio,bridge=vmbr1,firewall=0

# GPU Passthrough (uncomment if using dedicated GPU for AI)
# Requires IOMMU enabled in BIOS and grub: intel_iommu=on or amd_iommu=on
# Find GPU PCI address with: lspci -nn | grep -i nvidia
# hostpci0: 0000:01:00.0,pcie=1,x-vga=1

# QEMU Guest Agent
agent: 1

# Startup behavior
onboot: 0
boot: order=scsi0

# Performance tuning
numa: 0
hotplug: network,disk

# Additional features for AI workloads
# Enable nested virtualization if needed
args: -cpu host,+kvm_pv_unhalt,+kvm_pv_eoi

# Protection
protection: 0

# Tags for organization
tags: ubuntu;controller;ai

# Notes:
# After Ubuntu installation:
# 1. Configure static IP on internal interface:
#    - Edit /etc/netplan/00-installer-config.yaml
#    - Set enp6s19 (or similar) to 192.168.100.101/24
# 2. Install NVIDIA drivers if using GPU passthrough
# 3. Install Ollama for local LLM inference
# 4. Run ubu-cont/scripts/install_models.sh
